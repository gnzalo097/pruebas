{# ------------ CONFIGURACIONES COMUNES ------------ -#}

{# BANNER -#} 

banner login @ {{ Texto_Banner_Pre_Autenticacion }} @ 
banner exec @ {{ Texto_Banner_Post_Autenticacion }} @ 

{# FECHA_Y_HORA -#} 

clock set {{ hora_minuto_segundo }} {{ dia }} {{ mes }} {{ ano }}
{% if localizacion_canarias == false %}
clock timezone MET 1
{% endif %}
clock summer-time METDST recurring last Sun Mar 2:00 last Sun Oct 3:00 

{# HOSTNAME -#} 

hostname {{ Mnemonico_EDC }} 

{# Desactivacion de servicios no necesarios -#}  

no cdp run
no service tcp-small-servers 
no service udp-small-servers 
no service finger
no service dhcp
{% if modelo_equipo != "Cisco C1000"  %}
no ip source-route             
{% endif %}
no ip domain-lookup
no service config
no ip bootp server 
{# !! no ip bootp server !! si da error en algunos modelos no pasa nada -#} 
no ip name-server

service nagle
service tcp-keepalives-in
ip subnet-zero
service timestamps debug datetime localtime msec show-timezone
service timestamps log datetime localtime msec show-timezone

{# GESTION POR LOOPBACK -#} 

interface loopback 600
description Direccion IP de gestion EDC
ip address {{IPGestion}} 255.255.255.255
no ip directed-broadcast
no ip proxy-arp
no shutdown
exit

ip tftp source-interface Loopback 600
ip ftp source-interface Loopback 600
ip tacacs source-interface Loopback 600
logging source-interface Loopback 600
snmp-server trap-source Loopback 600
ntp source Loopback 600



{# ------------------------ CONTROL DE ACCESO AL EDC ------------------------ -#}

{# ------------ ESCENARIOS CON EDC SIMPLE ------------ -#}


{# Activación del servicio de encriptado de passwords -#} 

service password-encryption

{# Configuración de la contraseña de acceso al modo enable  -#} 

enable secret {{Password_Enable}}

{# Se crea un usuario local que permitirá el acceso al equipo vía consola y remoto  -#} 
username {{Usuario}} secret {{Password_Usuario}}


{#  Habilita el acceso SSH al equipo  -#} 

{% if modelo_equipo =="Cisco ASR903" or modelo_equipo =="Cisco ASR920" or modelo_equipo =="Cisco ASR1000" or modelo_equipo =="Familia ISR4000" or modelo_equipo =="Familia ISR1100" or modelo_equipo =="Cisco ASR1009-X" %}
ip domain name {{Mnemonico_EDC}}
{% else %}
ip domain-name {{Mnemonico_EDC}}
{% endif %}

crypto key generate rsa
{# !! se queda esperando a meter el valor  -#} 
1024
ip ssh version 2


{#  Filtro para controlar los accesos remotos al equipo - MacroLAN, VPNIP y DataInternet  -#} 

access-list 52 remark Accesos Remotos
{% for CentroGestion in CentrosGestion_MACROLAN_VPNIP_DATAINTERNET %}
access-list 52 permit {{CentroGestion.IP_CentroGestion}} {{CentroGestion.MascaraInversa}} 
{% endfor %}

access-list 52 permit host {{IP_PE_1}}
access-list 52 permit host {{IP_PE_2}}

{% if VLAN_Servicio_respaldo %}
access-list 52 permit host {{IP_PE_3}}
access-list 52 permit host {{IP_PE_4}}
{% endif %}

access-list 52 deny any


{#  Filtro para controlar los accesos remotos al equipo - Servicios SILAN e Ibercom Punto Central  -#} 

access-list 52 remark Accesos Remotos
{% for CentroGestion in CentrosGestion_SILAN_IBERCOM %}
access-list 52 permit {{CentroGestion.IP_CentroGestion}} {{CentroGestion.MascaraInversa}} 
{% endfor %}
access-list 52 permit  {{Red_VLAN_Gestion}}  {{MascaraInversa_VLAN_Gestion}}
access-list 52 deny any


{#  Configuracion extra  -#} 

line con 0
login local
exec-timeout   {{Timeout}}  
exit

{% if tiene_puerto_auxiliar %}

{% if modelo_equipo != "Cisco ASR920" and modelo_equipo != "Cisco ASR903" and modelo_equipo != "Familia ISR4000" and modelo_equipo != "Familia ISR1100" %} 

line aux 0
login local
exec-timeout   {{Timeout}}   
transport input telnet ssh
transport output telnet ssh
access-class 52 in
exit

{% endif %}
{% endif %}

line vty 0 4
login local
exec-timeout  {{Timeout}} 
transport input telnet ssh
transport output telnet ssh
access-class 52 in
exit

line vty 5 15
transport input none
transport output none
exit

{% if modelo_equipo == "Familia ISR1100" or modelo_equipo == "Familia ISR4000" %}
line 2
transport input none
exit
{% endif  %}


{#  Desactivación de los servidores HTTP/HTTPS  -#} 

no ip http server
no ip http secure-server


{# ------------ ESCENARIOS CON DOS O MAS EDC ------------ -#}

no access-list 52

access-list 52 remark Accesos Remotos
{% for CentroGestion in CentrosGestion %}
access-list 52 permit {{CentroGestion.IP_CentroGestion}} {{CentroGestion.MascaraInversa}} 
{% endfor %}

access-list 52 permit host {{IP_PE_1}}
access-list 52 permit host {{IP_PE_2}}

{% if VLAN_Servicio_respaldo %}
access-list 52 permit host {{IP_PE_3}}
access-list 52 permit host {{IP_PE_4}}
{% endif %}


{% for IP_LAN_EDC in IPs_LAN_EDC  %}
access-list 52 permit host  {{IP_LAN_EDC.IP}} 
{% endfor %}

access-list 52 deny any

